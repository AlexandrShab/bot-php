<?php
//testing
//echo '<h1>SertSaleBot</h1><br/>';
//https://api.telegram.org/bot1862861327:AAF7CJdOJaEoGEjqrbu8BgRaPyAsBfecgP0/setwebhook?url=https://sertbot.shinny-mir.by/index.php

//$bot_url = 'https://sertbot.shinny-mir.by';
require_once __DIR__ . '/autoload.php';

define('TOKEN','1862861327:AAF7CJdOJaEoGEjqrbu8BgRaPyAsBfecgP0');
define('TELEGA_URL', 'https://api.telegram.org/bot' . TOKEN);
define('MY_ID','968407066');
define('BOT_GROUP', '-1001523457115');   //SertBot_privateMessages
define('ADMINS_GROUP', '-1001630215811');   //Ð˜Ð½Ñ„Ð° Ð¾Ñ‚ SertSale Ð±Ð¾Ñ‚Ð¾Ð²
define('BOT_NAME','@SertSale_bot');


$updt = file_get_contents('php://input');
$update = json_decode($updt, TRUE);
file_put_contents('update.txt', '$update: ' .print_r($update,1)); 

//var_dump($data);

$telega = new Telega;
/*
if (isset($update['update_id']))
{
    $text = 'ÐŸÑ€Ð¸ÑˆÐµÐ» Ð½Ð¾Ð²Ñ‹Ð¹ update!' . json_encode($update);//
    $mes_id = $telega->sendMes(MY_ID, $text);
}*/
//~~~~~~~~~~~ ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð°Ð¿Ð´ÐµÐ¹Ñ‚Ð° Ñ‚Ð¸Ð¿Ð° message ~~~~~~
if(isset($update['message']))
{
    $msg = $update['message'];
    $tg_user = $msg["from"];
    $chat_id = $msg['chat']['id'];
    $chat_type = $msg['chat']['type'];
    $chat_title = isset($msg['chat']['title']) ? $msg['chat']['title'] : $tg_user['first_name'] . ' ' . $tg_user['last_name'];
    $message_id = $msg['message_id'];
    
    if(isset($msg['web_app_data']))//~~~ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ñ€Ð¸Ñ…Ð¾Ð´ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· WebApp ~~~~
    {
        $telega->sendMes(MY_ID, 'button_text:' . $msg['web_app_data']['button_text'] . '\n' . 'data:\n' . $msg['web_app_data']['data']);
    }
    if ($chat_type == 'private')// Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ð»Ð¸Ñ‡ÐºÐµ Ñ Ð±Ð¾Ñ‚Ð¾Ð¼
    {   //~~~~~~ Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ Ñ Ð®Ð·ÐµÑ€Ð¾Ð¼ Ð¸ Ð±Ð°Ð·Ð¾Ð¹ ~~~
        $base = new BaseAPI;
        $userFromBase = $base->getUser($tg_user['id']);
        if ($userFromBase == false)
        {
           $base->addUser($tg_user);
           $userFromBase = $base->getUser($tg_user['id']);
        }
        
       
        $user = new User($userFromBase);
        $user->update($tg_user);
        $telega->sendMes(MY_ID, "ÐŸÐ¸ÑˆÐµÑ‚ <b>$user->first_name $user->last_name</b> \nÐ”Ð°Ñ‚Ð° ÑÑ‚Ð°Ñ€Ñ‚Ð°: $user->date");
        
        if (isset($msg['entities'])){
            //~~~~~~~~~~~~~~~~~~~~~~~~~ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐšÐ¾Ð¼Ð°Ð½Ð´ Ð‘Ð¾Ñ‚Ñƒ~~~~~~~~~~~~~~~~~~~~~~~~
            if ( $msg['entities'][0]['type'] == 'bot_command')
            {    // Ð•ÑÐ»Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ - ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð±Ð¾Ñ‚Ñƒ
                  $telega->sendAction($chat_id);
                  /*
                  var count = varSheet.getRange(2,2).getValue(); // ÑÑ‡ÐµÑ‚Ñ‡Ð¸Ðº Ð²Ñ‹Ð·Ð¾Ð²Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´
                      count = count + 1;
                      varSheet.getRange(2,2).setValue(count);*/
              //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
             /* if (msg.text == ('/getchat'+botName) || msg.text == '/getchat'){ // ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ñ‡Ð°Ñ‚Ðµ
                sendMess(myId,chatId+'\n'+chatName+'\n'+chatType);
                getChat(chatId,chatName,chatType);return;     
              }*/
              //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
              if (($msg['text'] == ('/start' . BOT_NAME)) || ($msg['text'] == '/start'))
              { 
                $text2 = "ðŸ‘‹ Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ, " . $tg_user['first_name'] . "!\n\nÐ•ÑÐ»Ð¸ Ð²Ð°Ð¼ Ð½ÑƒÐ¶Ð½Ð° Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð½Ð° Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸ Ð½Ð° Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¿Ð»ÐµÐ¹ÑÐµ(-Ð°Ñ…) Ð¸Ð»Ð¸ ÐµÑÑ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¿Ð¾ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ†Ð¸Ð¸ Ð¸ ÑƒÑÐ»ÑƒÐ³, Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ Ð²Ñ‹ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ.\n\nÐœÑ‹ Ð°ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¾Ñ€Ð³Ð°Ð½ Ð¿Ð¾ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð²Ñ‹Ð³Ð¾Ð´Ð½Ð°Ñ, Ð° ÑÑ€Ð¾ÐºÐ¸ Ð¾Ñ‚ 1 Ð´Ð½Ñ.\n\nðŸ‘‰ Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ @blondin_man Ð´Ð»Ñ Ð·Ð°ÐºÐ°Ð·Ð° Ð¸ ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ð¸Ð¸, Ð¼Ñ‹ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÐ¼.";
                $telega->sendMes($chat_id, $text2);
                return;
              }
              return;
              if (($msg['text'] == ('/help' . BOT_NAME)) || ($msg['text'] == '/help'))
              { 
                include_once __DIR__ . "/functions/work.php"
                $textAbout = 'Ð¦ÐµÐ½Ñ‚Ñ€ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Â«SertSaleÂ» ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð°ÐºÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼ Ð¾Ñ€Ð³Ð°Ð½Ð¾Ð¼ Ð¿Ð¾ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸, Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð² Ð¤ÐµÐ´ÐµÑ€Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð¡Ð»ÑƒÐ¶Ð±Ðµ ÐÐºÐºÑ€ÐµÐ´Ð¸Ñ‚Ð°Ñ†Ð¸Ð¸ (Ð¤Ð¡Ð) Ð¸ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ ÑƒÑÐ»ÑƒÐ³ Ð¿Ð¾ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸ÑŽ Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ Ð½Ð° Ð’Ð°ÑˆÐ¸ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹:\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¿Ð»ÐµÐ¹ÑÐ¾Ð²\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð Ð¤ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÐµÐ¹\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚ÐµÑ€Ð¾Ð²\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð´Ð»Ñ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚ÐµÑ€Ð¾Ð²\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ñ‹ Ð¢Ð°Ð¼Ð¾Ð¶ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐ¾ÑŽÐ·Ð°\nâ€¢ Ð”ÐµÐºÐ»Ð°Ñ€Ð°Ñ†Ð¸Ð¸ Ð¢Ð°Ð¼Ð¾Ð¶ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐ¾ÑŽÐ·Ð°\nâ€¢ ÐŸÑ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ñ‹ Ð»Ð°Ð±Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€Ð½Ñ‹Ñ… Ð¸ÑÐ¿Ñ‹Ñ‚Ð°Ð½Ð¸Ð¹\nâ€¢ ÐžÑ‚ÐºÐ°Ð·Ð½Ñ‹Ðµ Ð¿Ð¸ÑÑŒÐ¼Ð° Ð½Ð° Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ†Ð¸ÑŽ\nâ€¢ Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð½Ð°ÐºÐ°\nâ€¢ Ð¡Ð²Ð¸Ð´ÐµÑ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾ Ð¾ Ð³Ð¾ÑÑƒÐ´Ð°Ñ€ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¹ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸\nâ€¢ Ð­ÐºÑÐ¿ÐµÑ€Ñ‚Ð½Ð¾Ðµ Ð—Ð°ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð Ð¾ÑÐ¿Ð¾Ñ‚Ñ€ÐµÐ±Ð½Ð°Ð´Ð·Ð¾Ñ€Ð°\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ / Ð´ÐµÐºÐ»Ð°Ñ€Ð°Ñ†Ð¸Ñ Ð¢Ð  Ð¢Ð¡\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ñ‚ÐºÐ°Ñ‚Ñ‹ ISO\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð ÐŸÐž\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð“ÐžÐ¡Ð¢ Ð \nâ€¢ Ð”ÐµÐºÐ»Ð°Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð“ÐžÐ¡Ð¢ Ð \nâ€¢ Ð”Ð¾Ð±Ñ€Ð¾Ð²Ð¾Ð»ÑŒÐ½Ð°Ñ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ\nâ€¢ ÐŸÐ¾Ð¶Ð°Ñ€Ð½Ð°Ñ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ / Ð´ÐµÐºÐ»Ð°Ñ€Ð°Ñ†Ð¸Ñ\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ ÑƒÑÐ»ÑƒÐ³\nâ€¢ Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð£ÑÐ»Ð¾Ð²Ð¸Ð¹\nâ€¢ Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¢ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸\nâ€¢ Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐŸÐ°ÑÐ¿Ð¾Ñ€Ñ‚Ð¾Ð² Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸\nâ€¢ Ð¨Ñ‚Ñ€Ð¸Ñ…ÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ†Ð¸Ð¸\nâ€¢ Ð­ÐºÐ¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¥Ð°Ð»ÑÐ»ÑŒ\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ ÐšÐ¾ÑˆÐµÑ€Ð½Ð¾ÑÑ‚Ð¸\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ Ð‘Ð¸Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ñ‚ÐºÐ°Ñ‚ ÐžÑ€Ð³Ð°Ð½Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ Ð¾Ñ‚ÑÑƒÑ‚ÑÐ²Ð¸Ñ Ð“ÐœÐž\nâ€¢ Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð° Ð¡Ð¢ -1\nÐ˜ Ð¼Ð½Ð¾Ð³Ð¸Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ðŸ—‚\n\nâœ… Ð˜Ð¼ÐµÐµÐ¼ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½ÑƒÑŽ Ð»Ð°Ð±Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€Ð¸ÑŽ Ð² Ð³Ð¾Ñ€Ð¾Ð´Ðµ ÐœÐ¾ÑÐºÐ²Ð°!\nâœ… Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ Ð¿Ð¾ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñƒ Ñ ÑƒÐºÐ°Ð·Ð°Ð½Ð¸ÐµÐ¼ ÑÑ€Ð¾ÐºÐ¾Ð² Ð¸ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸!\nâœ… Ð¡Ñ€Ð¾ÐºÐ¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾Ð¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ Ð¾Ñ‚ 1 Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ³Ð¾ Ð´Ð½Ñ!\nâœ… Ð”Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð¿Ð¾ Ð³Ð¾Ñ€Ð¾Ð´Ð°Ð¼ Ð Ð¾ÑÑÐ¸Ð¸!\n\nâ˜Žï¸ 8 800 707-40-97 (Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð¾ Ð¿Ð¾ Ð Ð¤)';
                
                $telega->sendInlineKeyboard($chat_id, $textAbout, writeToExpertKeyboard();)
                
                return;
              }
              return;
            }// ~~~~~~~~ÐºÐ¾Ð½ÐµÑ† Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ ÐºÐ¾Ð¼Ð°Ð½Ð´~~~~~~~
        }
    }else{return;}
    
    
}// ~~~~~ End Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð°Ð¿Ð´ÐµÐ¹Ñ‚Ð° Ñ‚Ð¸Ð¿Ð° message ~~~~~~



//~~~~~~~FUNCTIONS~~~~~~~~~~~~~~~~~~
